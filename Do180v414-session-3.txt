# Quick Recap:- (10-15 mins).
- Unit-1-) Introduction to Kubernetes and OpenShift
- Describe the main characteristics of containers and Kubernetes.
-  Describe the relationship between OpenShift, Kubernetes, and other Open Source projects, and list key features of Red Hat OpenShift products and editions.

- Unit-2-) 
- Kubernetes & OpenShift CLI part.
- Inspect kubernetes resources [POD,Service,Deployment etc ]
- Access the health of kubernetes cluster.

- Unit-3) Applications as Containers and Pods.  
- Create Linux Containers and Kubernetes Pods (oc run command).
- FInd and inspact container images.
- Troubleshoot Containers and Pods

  - Kubernetes vs OpenShift 
  - Containerization (via Container Engine & Orchetration tool like k8s).
  - OpenShift Login to cluster.
    Web Console & CLI login.
	 User/password [IdP=htpasswd;LDAP;OIDC;Active Directory etc]
	 API Login - https://api.clusterName.baseDomain:6443
	           - https://api.ocp4.example.com:6443 
	 		   - $ oc login -u admin -p redhatocp https://api.ocp4.exmaple.com:6443 
			   - After login verify the access and cluster details.
			   - Use "oc" & "kubectl" via CLI login to cluster.  
				 $ oc get nodes 
				 $ oc version 
				 $ oc get clusterversion 
				 $ oc whoami 
				 $ oc whoami -t 
				 $ oc whoami --show-console 
				 https://concole-openshift-console.apps.ocp4.example.com
				 
				 $ kubectl get nodes 
				 $ kubectl get pods 
				 $ kubectl get svc 
				 $ kubectl get configmap 
				 $ kubectl get secret 
				 
	Kubernetes:- POD - oc run , namespace create and deployed application on this same namespace.
-----------------------------------------------
- Login to OCP cluster as admin/cluster-admin via CLI/Web Console.
- Create namespace (oc new-project, oc create namespace <>).
- MOve to same namespace & verify .
- Deploy POD via (oc run command). 
- Operation w.r.t POD.
Reference link - https://github.com/cprakash2118/DO180-nodes/blob/main/Do180v414-session-012txt.txt

LAB Setup:-
Task-1
User creation via htpasswd:-
- user1/redhat 
- user2/redhat 
- IdP Name= SRE-Team 

Note: 

$ oc get oauth/cluster -o yaml > oauth.yaml
$ vim oauth.yaml 
And update with correct syntax (YAML)
$ oc apply -f oauth.yaml

or
*****************
- Login to Web Console as cluster-admin.
- Left hand side - Click on "Administration" - DropDown 
- Then - Click on cluster settings.
- Then - Click on "Configuration"
- Then type on search BOX "oauth"
- Then clock on Oauth 
- Scroll Down and then click on add on "Identity Provider" section.
- Name=SRE-Team
- Browse and load "htpasswd" file 
- Click on Add.
******************
$ oc get pods -n openshift-authentication
$ oc login -u user1 -p redhat https://api.ocp4.example.com:6443 
$ oc whoami -t
$ oc get nodes 

Do the same with user2 



-------------
Task-2
- Create namespace ns-day03-part1 
- Move to this namespace and deploy 3 applications as per below input.
- information:-
 
 image=quay.io/cprakash2118/java-unzip-httpd-image
  appName=myapp01 
 
 image=quay.io/cprakash2118/ubi9-apache 
 appName=myapp02 
 
 Image=quay.io/cprakash2118/mysql-rhel8-80
 appName=mydb01 
 
- If any pod not getting started/up the what shoud be the appoach.
- Check the current load (CPU and Memory ulization).

************************* Fix for the POD issue as of now ************************
$ oc project ns-day03-part1
$ oc project -q
ns-day03-part1
$ oc get pods
$ oc logs myapp01
$ oc logs myapp02
$ oc logs mydb01

Note: Permission issues, how to fix ?

Solution- Create service account and provide priveliage 
$ oc create serviceaccount myapp-sa 
$ oc get serviceaccount 
$ oc get scc 

$ oc adm policy add-scc-to-user anyuid -z myapp-sa 

$ oc set serviceaccount 
*************************************************************************************************
- Login to OCP cluster [Web COnsole & CLI]
- Create kubernetes/OpenShift resources -
  [namespace, pod, replicaset, deployment etc]
  FYI- namespace also know as project.

 $ oc run myapp --image image-url 
 $ oc get pods 
 NOte: Single pod created.
 Get the image URL - oc get istag -n openshift | grep http 
 
 
 $ oc run myapp --image httpd --dry-run=client -o yaml > myapp.yaml 
 $ oc create -f myapp.yaml 
 
 
***********************************************
oc run mysql-server --image registry.ocp4.example.com:8443/rhel9/mysql-80:1228  --env MYSQL_USER=redhat --env MYSQL_PASSWORD=redhat123 --env MYSQL_DATABASE=world

##################################################
oc new-app --name mysql registry.ocp4.example.com:8443/rhel9/mysql-80:1228

-------------------------------------------------------------------------------
Unit-4-) Deploy Managed and Networked Applications on Kubernetes:-

- Deploy application using kubernetes/openshift resources:-
- kubernetes/OpenShift resources:-
1-POD 
2-ReplicaSet (rs)
3-Deployment (deploy)
4-DaemonSet 
5-StatefulSet 
6-ConfigMap (cm)
7-Secret 
8-service (svc)
9-route
10-pvc 
11-namespace

Image - registry.ocp4.example.com:8443/redhattraining/webphp:v2

## Imperative vs Declarative workflow:-
- Imperative workflow:-
  $ oc new-project ns-project01 
  
  $ oc project -q 
  $ oc get all 
  
  As of now login as admin (so that no permission issues).
  $ oc run myapp --image registry.ocp4.example.com:8443/redhattraining/webphp:v2
  $ oc get pods 
  NOte: Only pod.
  
  $ oc port-forward pod/myapp 8080:8080
  $  curl 127.0.0.1:8080
  or
  $ curl 127.0.0.1:8080/index.php


- Declarative workflow:-
  $ oc new-project ns-project02 --dry-run=client -o yaml > pod-ns.yaml  [This will not work]
  $ oc create namespace ns-project02 --dry-run=client -o yaml > pod-ns-2.yaml 
  
  $ oc run myapp2 --image registry.ocp4.example.com:8443/redhattraining/webphp:v2 --dry-run=client -o yaml -n ns-project02 > pod-myapp2.yaml 
  $ vim pod-myapp.yaml 
  $ oc create -f pod-ns-2.yaml
  $ oc create -f pod-myapp.yaml 


- Data base deploymeny via commnad line and file (yaml).
  $ oc create namespace ns-project03 --dry-run=client -o yaml > pod-ns-3.yaml
  $ oc run mysql-server --image registry.ocp4.example.com:8443/rhel9/mysql-80:1-228  --env MYSQL_USER=redhat --env MYSQL_PASSWORD=redhat123 --env MYSQL_DATABASE=world 


oc run mysql-server --image registry.ocp4.example.com:8443/rhel9/mysql-80:1-228  --env MYSQL_USER=redhat --env MYSQL_PASSWORD=redhat123 --env MYSQL_DATABASE=world --dry-run=client -n ns-project03 -o yaml  > mysql-pod-p3.yaml 

----------------------------------------------------------------